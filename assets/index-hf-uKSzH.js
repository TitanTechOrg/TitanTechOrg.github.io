import{ag as h,a6 as y,a7 as v,j as e,aS as x,aT as f,p as c,aU as g,aV as N,aW as b,aX as w,aC as _,af as o,P as C,aY as P}from"./index-CENqs8IR.js";import{C as L,u as R}from"./get-overview-players-Dh7lCOP5.js";import{b as m,u as S}from"./get-raid-list-CRoxm1ng.js";import{s as O,R as F}from"./raid-card-BYKbtUPl.js";import"./chunk-BHGNW4BO-CWrceOls.js";import"./index-B4XPM2LG.js";function I(a){return h({queryKey:["player_profile",a],queryFn:async()=>await A(a),enabled:!!a})}async function A(a){let r="";const l=new URLSearchParams;a&&l.append("clan_player_id",a),l.size&&(r+="?",r+=l);const s=v.profile+r;return await y.get(s)}function T({overviewPlayers:a,isLoading:r}){return e.jsx("div",{children:!r&&a?e.jsx(L,{selectKey:"player-selector",label:"Clan member",placeholder:"Select player",options:a.players_data.map(l=>({value:l.player_id,label:l.player_name})).sort((l,s)=>l.label.localeCompare(s.label))}):e.jsx(O,{className:"min-h-14 w-full max-w-xs rounded-lg px-3 py-2"})})}function B(a){if(a.length===0)return 0;const r=a.reduce((l,s)=>l+s.level,0);return parseFloat((r/a.length).toFixed(2))}function E({playerProfile:a}){return e.jsxs("div",{className:"col-span-1 row-start-2",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Player stats"}),e.jsx("div",{className:"flex h-full flex-col justify-between gap-1",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Ingame name"}),a.name]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Loyalty"}),a.loyalty_level]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Raid level"}),a.player_raid_level]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Wildcards"}),a.raid_wildcard_count]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Total Card Level"}),a.total_card_level]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Average Card Level"}),B(a.cards)]})]})})]})}function k({cards:a}){const{filters:r,toggleFilter:l}=x(),s=a.map(t=>({...t,readable_name:m(f(t.skill_name))}));return e.jsxs("div",{className:"col-span-2 row-start-3 flex flex-col gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Raid Cards"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{onPress:()=>l("sortBy"),children:r.sortBy}),e.jsx(c,{onPress:()=>l("sortOrder"),endContent:r.sortOrder===g.sortOrder[0]?e.jsx(N,{}):e.jsx(b,{}),children:r.sortOrder})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(n,{title:"Burst",data:{cards:s}}),e.jsx(n,{title:"Affliction",data:{cards:s}}),e.jsx(n,{title:"Support",data:{cards:s}})]})]})}function U(a,r,l){const s=a.sortOrder==="Asc";return(a.sortBy==="Sort by Name"?"skill_name":"level")==="level"?s?r.level-l.level:l.level-r.level:s?r.readable_name.localeCompare(l.readable_name):l.readable_name.localeCompare(r.readable_name)}function n({title:a,data:r}){const{filters:l}=x();return e.jsxs("div",{className:"w-full",children:[e.jsx("h1",{className:"pb-2 text-left text-lg font-medium",children:a}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.cards.filter(s=>w(s.skill_name)===a).map(s=>({...s,readable_name:m(f(s.skill_name))})).sort((s,t)=>U(l,s,t)).map(({skill_name:s,level:t,readable_name:d})=>e.jsx(F,{name:s,value:t,readableName:d},s))})]})}function Q(){const{data:a,isLoading:r}=S(),l=a?.raids.find(j=>j.ended_at!=null)?.raid_id,{data:s,isLoading:t}=R(l),{selectedValues:d}=_(),{data:i,isLoading:u,isError:p}=I(d["player-selector"]);return r?e.jsx("div",{className:"flex h-dvh justify-center",children:e.jsx(o,{})}):e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 text-left sm:grid-cols-2",children:[e.jsxs("div",{className:"col-span-2 row-span-1 row-start-1",children:[e.jsxs("div",{className:"mb-2 flex flex-col items-start justify-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Player Raid Profile"}),e.jsx("p",{children:"Select a player to show their raid info"}),e.jsx("p",{className:"text-xs italic",children:"Players are fetched based on previous raid"})]}),s?e.jsx(T,{overviewPlayers:s,isLoading:t}):e.jsx("p",{children:"No data yet. Complete a raid and try again."})]}),u?e.jsx("div",{className:"col-span-2 mx-auto justify-center",children:e.jsx(o,{label:"Loading player data..."})}):p?e.jsx("div",{className:"col-span-2 mx-auto justify-center",children:"Player data could not be fetched. Is the player currently in the clan?"}):i&&e.jsxs(e.Fragment,{children:[e.jsx(E,{playerProfile:i}),e.jsx(k,{cards:i.cards}),e.jsx("div",{className:"col-span-2 row-start-4",children:e.jsx(P,{cards:i.cards},"RaidCardsLevelChart")})]})]})})}export{Q as default};

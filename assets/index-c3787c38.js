import{a8 as g,a9 as b,j as e,aN as j,q as u,aO as C,p as N,aP as w,ab as o,aq as _,ad as p,P as L}from"./index-becd865d.js";import{C as P,u as R}from"./get-overview-players-776b0067.js";import{d as S,e as h,b as k}from"./get-raid-list-13859bcb.js";import{s as O,f as x,a as I,R as A,g as F}from"./raid-card-b3dbac99.js";import{c as T,d as B}from"./react-icons.esm-b1121b5b.js";import"./utils-30afb2d9.js";import"./chunk-UWUNWEEL-bcbfe056.js";import"./index-74eb83b6.js";function D(a){return S({queryKey:["player_profile",a],queryFn:async()=>await E(a),enabled:!!a})}async function E(a){let r="";const l=new URLSearchParams;a&&l.append("clan_player_id",a),l.size&&(r+="?",r+=l);const s=b.profile+r;return await g.get(s)}function q({overviewPlayers:a,isLoading:r}){return e.jsx("div",{children:!r&&a?e.jsx(P,{selectKey:"player-selector",label:"Clan member",placeholder:"Select player",options:a.players_data.map(l=>({value:l.player_id,label:l.player_name})).sort((l,s)=>l.label.localeCompare(s.label))}):e.jsx(O,{className:"min-h-14 w-full max-w-xs rounded-lg px-3 py-2"})})}function U(a){if(a.length===0)return 0;const r=a.reduce((l,s)=>l+s.level,0);return parseFloat((r/a.length).toFixed(2))}function z({playerProfile:a}){return e.jsxs("div",{className:"col-span-1 row-start-2",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Player stats"}),e.jsx("div",{className:"flex h-full flex-col justify-between gap-1",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Ingame name"}),a.name]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Loyalty"}),a.loyalty_level]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Raid level"}),a.player_raid_level]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Wildcards"}),a.raid_wildcard_count]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Total Card Level"}),a.total_card_level]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Average Card Level"}),U(a.cards)]})]})})]})}function $({cards:a}){const{filters:r,toggleFilter:l}=j(),s=a.map(t=>({...t,readable_name:h(x(t.skill_name))}));return e.jsxs("div",{className:"col-span-2 row-start-3 flex flex-col gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Raid Cards"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{onClick:()=>l("sortBy"),children:r.sortBy}),e.jsx(u,{onClick:()=>l("sortOrder"),endContent:r.sortOrder===C.sortOrder[0]?e.jsx(T,{}):e.jsx(B,{}),children:r.sortOrder})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(m,{title:"Burst",data:{cards:s}}),e.jsx(m,{title:"Affliction",data:{cards:s}}),e.jsx(m,{title:"Support",data:{cards:s}})]})]})}function H(a,r,l){const s=a.sortOrder==="Asc";return(a.sortBy==="Sort by Name"?"skill_name":"level")==="level"?s?r.level-l.level:l.level-r.level:s?r.readable_name.localeCompare(l.readable_name):l.readable_name.localeCompare(r.readable_name)}function m({title:a,data:r}){const{filters:l}=j();return e.jsxs("div",{className:"w-full",children:[e.jsx("h1",{className:"pb-2 text-left text-lg font-medium",children:a}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.cards.filter(s=>I(s.skill_name)===a).map(s=>({...s,readable_name:h(x(s.skill_name))})).sort((s,t)=>H(l,s,t)).map(({skill_name:s,level:t,readable_name:i})=>e.jsx(A,{name:s,value:t,readableName:i},s))})]})}const c=20;function K({cards:a}){const{darkMode:r}=N(),l=a.map((i,n)=>{const d=new Image(c,c);return d.src=F(i.skill_name),{x:i.level,y:n,label:x(i.skill_name),pointStyle:d||void 0}}),s={datasets:[{label:"Card Levels",data:l,backgroundColor:"rgba(75, 192, 192, 0.6)",borderColor:"rgba(75, 192, 192, 1)",pointRadius:c/2,pointHoverRadius:c/2+2,pointStyle:l.map(i=>i.pointStyle)}]},t={responsive:!0,maintainAspectRatio:!1,scales:{x:{beginAtZero:!0,max:100,title:{display:!0,text:"Levels"},grid:{color(){return r?o.dark:o.light}}},y:{ticks:{display:!1},title:{display:!1},grid:{color(){return r?o.dark:o.light}}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:i=>{const n=a[i.dataIndex];return`${x(n.skill_name).replace(/([A-Z])/g," $1").trim()}: Level ${n.level}`}},displayColors:!1},title:{display:!0,text:"Card Level Distribution",font:{size:18,weight:"bold"}}}};return e.jsx("div",{className:"flex h-96 w-full items-center justify-center",children:e.jsx(w,{data:s,options:t})})}function Y(){var f;const{data:a,isLoading:r}=k(),l=(f=a==null?void 0:a.raids.find(v=>v.ended_at!=null))==null?void 0:f.raid_id,{data:s,isLoading:t}=R(l),{selectedValues:i}=_(),{data:n,isLoading:d,isError:y}=D(i["player-selector"]);return r?e.jsx("div",{className:"flex h-dvh justify-center",children:e.jsx(p,{})}):e.jsx(L,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 text-left sm:grid-cols-2",children:[e.jsxs("div",{className:"col-span-2 row-span-1 row-start-1",children:[e.jsxs("div",{className:"mb-2 flex flex-col items-start justify-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Player Raid Profile"}),e.jsx("p",{children:"Select a player to show their raid info"})]}),e.jsx(q,{overviewPlayers:s,isLoading:t})]}),d?e.jsx("div",{className:"col-span-2 mx-auto justify-center",children:e.jsx(p,{label:"Loading player data..."})}):y?e.jsx("div",{className:"col-span-2 mx-auto justify-center",children:"Player data could not be fetched. Is the player currently in the clan?"}):n&&e.jsxs(e.Fragment,{children:[e.jsx(z,{playerProfile:n}),e.jsx($,{cards:n.cards}),e.jsx("div",{className:"col-span-2 row-start-4",children:e.jsx(K,{cards:n.cards},"RaidCardsLevelChart")})]})]})})}export{Y as default};
